---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const projects = await getCollection("projects");
const sortedProjects = projects.sort((a, b) => {
  // Featured projects first, then by year (newest first)
  if (a.data.featured !== b.data.featured) {
    return a.data.featured ? -1 : 1;
  }
  return (b.data.year ?? 0) - (a.data.year ?? 0);
});
---

<BaseLayout
  title="Projects"
  description="A curated selection of projects I've worked on, from LLM tooling to open source contributions."
>
  <h1 class="text-4xl font-bold mb-4">Projects</h1>
  <p class="text-lg text-[var(--color-text-muted)] mb-8">
    A curated selection of projects I've worked on.
  </p>

  {
    sortedProjects.length === 0 ? (
      <p class="text-[var(--color-text-muted)]">Projects coming soon!</p>
    ) : (
      <ul class="grid gap-6">
        {sortedProjects.map((project) => (
          <li class="p-6 border border-[var(--color-border)] rounded-lg hover:border-[var(--color-accent)] transition-colors">
            <div class="flex items-start justify-between gap-4">
              <div>
                <h2 class="text-xl font-semibold">
                  {project.data.url ? (
                    <a
                      href={project.data.url}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="hover:text-[var(--color-accent)]"
                    >
                      {project.data.title}
                    </a>
                  ) : (
                    project.data.title
                  )}
                </h2>
                <p class="text-[var(--color-text-muted)] mt-2">
                  {project.data.description}
                </p>
              </div>
              {project.data.featured && (
                <span class="px-2 py-1 text-xs bg-[var(--color-accent)] text-white rounded shrink-0">
                  Featured
                </span>
              )}
            </div>

            <div class="flex flex-wrap items-center gap-4 mt-4">
              {project.data.tags.length > 0 && (
                <div class="flex flex-wrap gap-2">
                  {project.data.tags.map((tag: string) => (
                    <span class="px-2 py-0.5 text-xs bg-[var(--color-border)] rounded">
                      {tag}
                    </span>
                  ))}
                </div>
              )}

              {project.data.repo && (
                <a
                  href={project.data.repo}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-sm text-[var(--color-text-muted)] hover:text-[var(--color-accent)]"
                >
                  GitHub &rarr;
                </a>
              )}

              {project.data.year && (
                <span class="text-sm text-[var(--color-text-muted)]">
                  {project.data.year}
                </span>
              )}

              <span
                class:list={[
                  "text-xs px-2 py-0.5 rounded",
                  {
                    "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":
                      project.data.status === "active",
                    "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":
                      project.data.status === "maintained",
                    "bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300":
                      project.data.status === "archived",
                  },
                ]}
              >
                {project.data.status}
              </span>
            </div>
          </li>
        ))}
      </ul>
    )
  }
</BaseLayout>
